<aside
  [style.width.px]="currentWidth()"
  styleClass="sidebar"
  class="sidebar flex flex-col font-sans shadow-md"
  [ngClass]="className()"
>
  <!-- Brand -->
  <div class="flex items-center justify-between px-6 py-6">
    @if (!isSidebarCollapsed()) {
      <div class="flex items-center gap-2">
        <span class="text-(--color-primary) font-bold text-2xl tracking-tight">{{ 'app.name' | translate }}</span>
        <span class="bg-(--primary)/10 text-(--color-primary) text-xs font-bold px-2 py-0.5 rounded-full uppercase tracking-wider">
          {{ 'app.country' | translate }}
        </span>
      </div>
    }
  </div>

  <!-- Nav -->
  <nav
    [class]="'flex-1 flex flex-col overflow-y-auto ' + (isSidebarCollapsed() ? 'gap-1 px-2 pt-2' : 'gap-1 px-3 pt-2')"
    role="navigation"
    [attr.aria-label]="'nav.mainMenu' | translate"
  >
    <app-sidebar-group>
      @if (!isSidebarCollapsed()) {
        <app-sidebar-group-label class="px-3 mb-2 mt-2">{{ 'nav.mainMenu' | translate }}</app-sidebar-group-label>
      }

      @for (item of menuItems(); track item.label) {
        <a
          [routerLink]="item.routerLink"
          routerLinkActive="active"
          class="sidebar-item group"
          [class.justify-center]="isSidebarCollapsed()"
          [class.justify-start]="!isSidebarCollapsed()"
          [attr.aria-label]="item.label | translate"
          [pTooltip]="isSidebarCollapsed() ? (item.label | translate) : ''"
          tooltipPosition="right"
        >
          <i [class]="item.icon + (isSidebarCollapsed() ? '' : ' mr-3')" class="text-lg transition-colors group-hover:text-(--primary)" aria-hidden="true"></i>

          @if (!isSidebarCollapsed()) {
            <span class="font-medium text-sm">{{ item.label | translate }}</span>
          }
        </a>
      }
    </app-sidebar-group>
  </nav>

  <!-- User Profile -->
  <div class="mt-auto p-4 border-t border-gray-100">
    <button
      type="button"
      [class]="
        'w-full hover:bg-gray-50 flex cursor-pointer items-center rounded-lg transition-all duration-200 border border-transparent hover:border-gray-200 p-2 ' +
        (isSidebarCollapsed() ? 'justify-center' : 'gap-3')
      "
      [pTooltip]="isSidebarCollapsed() ? userDisplayName() : ''"
      tooltipPosition="right"
      [attr.aria-label]="'User profile: ' + userDisplayName()"
    >
      <p-avatar icon="pi pi-user" shape="circle" styleClass="bg-gray-100 text-gray-600"></p-avatar>

      @if (!isSidebarCollapsed()) {
        <div class="flex-1 text-left overflow-hidden">
          <div class="font-semibold text-sm text-gray-900 truncate">{{ userDisplayName() }}</div>
          <div class="text-xs text-gray-500 truncate">{{ userRoleLabel() | translate }}</div>
        </div>
        <i class="pi pi-chevron-up text-xs text-gray-400"></i>
      }
    </button>
    
    <div class="mt-2">
      @if (!isSidebarCollapsed()) {
        <!-- Logout Button (expanded) -->
        <button
          pButton
          type="button"
          class="w-full btn btn-ghost text-gray-500 hover:text-red-600 hover:bg-red-50 justify-center px-2"
          [label]="'auth.logout' | translate"
          icon="pi pi-sign-out"
          (click)="logout()"
        ></button>
      } @else {
        <!-- Logout Button (collapsed) -->
        <div class="flex justify-center">
          <button
            pButton
            type="button"
            class="p-button-text p-button-rounded text-gray-500 hover:text-red-600 hover:bg-red-50"
            icon="pi pi-sign-out"
            (click)="logout()"
          ></button>
        </div>
      }
    </div>
  </div>
</aside>
