<p-toast></p-toast>

<div class="p-6">
  <div class="flex justify-between items-center mb-6">
    <div>
      <h2 class="text-xl font-semibold text-gray-900">{{ 'company.employeeCategories.title' | translate }}</h2>
      <p class="text-sm text-gray-600 mt-1">{{ 'company.employeeCategories.subtitle' | translate }}</p>
    </div>
    <button
      pButton
      type="button"
      icon="pi pi-plus"
      [label]="'company.employeeCategories.add' | translate"
      (click)="openCreateDialog()"
      class="p-button-sm"
    ></button>
  </div>

  @if (isLoading()) {
    <div class="flex items-center gap-2 text-gray-600">
      <i class="pi pi-spin pi-spinner"></i>
      <span>{{ 'common.loading' | translate }}</span>
    </div>
  } @else {
    <p-table [value]="categories()" responsiveLayout="scroll" styleClass="p-datatable-sm">
      <ng-template pTemplate="header">
        <tr>
          <th>{{ 'company.employeeCategories.table.name' | translate }}</th>
          <th>{{ 'company.employeeCategories.table.mode' | translate }}</th>
          <th style="width: 150px">{{ 'common.actions' | translate }}</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-category>
        <tr>
          <td>{{ category.name }}</td>
          <td>{{ category.modeDescription || category.mode || '-' }}</td>
          <td>
            <div class="flex gap-2">
              <button
                pButton
                type="button"
                icon="pi pi-pencil"
                class="p-button-text p-button-sm"
                (click)="openEditDialog(category)"
                [pTooltip]="'common.edit' | translate"
              ></button>
              <button
                pButton
                type="button"
                icon="pi pi-trash"
                class="p-button-text p-button-sm p-button-danger"
                (click)="deleteCategory(category)"
                [pTooltip]="'common.delete' | translate"
              ></button>
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="3" class="text-center py-8 text-gray-500">
            {{ 'company.employeeCategories.noCategories' | translate }}
          </td>
        </tr>
      </ng-template>
    </p-table>
  }
</div>

<!-- Create/Edit Dialog -->
<p-dialog
  [(visible)]="showDialog"
  [header]="(isEditing() ? 'company.employeeCategories.editTitle' : 'company.employeeCategories.createTitle') | translate"
  [modal]="true"
  [style]="{ width: '500px' }"
  [draggable]="false"
  [resizable]="false"
>
  <form [formGroup]="categoryForm" (ngSubmit)="save()">
    <div class="space-y-4">
      <div class="field">
        <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
          {{ 'company.employeeCategories.form.name' | translate }} <span class="text-red-500">*</span>
        </label>
        <input
          pInputText
          id="name"
          formControlName="name"
          class="w-full"
          [placeholder]="'company.employeeCategories.form.namePlaceholder' | translate"
        />
        @if (categoryForm.get('name')?.invalid && categoryForm.get('name')?.touched) {
          <small class="text-red-500">{{ 'errors.required' | translate }}</small>
        }
      </div>

      <div class="field">
        <label for="mode" class="block text-sm font-medium text-gray-700 mb-2">
          {{ 'company.employeeCategories.form.mode' | translate }} <span class="text-red-500">*</span>
        </label>
        <select id="mode" formControlName="mode" class="w-full p-inputtext">
          <option [value]="0">{{ 'company.employeeCategories.form.modeOptions.company' | translate }}</option>
          <option [value]="1">{{ 'company.employeeCategories.form.modeOptions.global' | translate }}</option>
        </select>
      </div>
    </div>

    <div class="flex justify-end gap-2 mt-6">
      <button
        pButton
        type="button"
        [label]="'common.cancel' | translate"
        class="p-button-text"
        (click)="closeDialog()"
      ></button>
      <button
        pButton
        type="submit"
        [label]="'common.save' | translate"
        [disabled]="categoryForm.invalid"
      ></button>
    </div>
  </form>
</p-dialog>
