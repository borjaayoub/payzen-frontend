<div class="min-h-screen bg-(--bg-page)">
  <main class="max-w-6xl mx-auto p-6">
    <!-- Page Header -->
    <div class="mb-6">
      <h1 class="text-2xl font-semibold text-gray-900">{{ 'attendance.title' | translate }}</h1>
      <p class="text-sm text-gray-600 mt-1">{{ 'attendance.subtitle' | translate }}</p>
    </div>

    <!-- Today's Status Card -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
      <p-card styleClass="shadow-sm border border-gray-200">
        <ng-template pTemplate="header">
          <div class="px-6 pt-6 pb-4 border-b border-gray-100">
            <h2 class="text-lg font-semibold text-gray-900">{{ 'attendance.todayStatus' | translate }}</h2>
          </div>
        </ng-template>

        <div class="space-y-4">
          <!-- Current Status -->
          <div class="flex items-center justify-between">
            <span class="text-sm text-gray-600">{{ 'attendance.currentStatus' | translate }}</span>
            <span class="px-3 py-1 rounded-full text-xs font-medium"
                  [ngClass]="todayStatus() === 'checkedOut' ? 'bg-gray-100 text-gray-700' : 
                             todayStatus() === 'checkedIn' ? 'bg-green-100 text-green-700' : 
                             'bg-yellow-100 text-yellow-700'">
              {{ 'attendance.' + todayStatus() | translate }}
            </span>
          </div>

          @if (todayAttendance(); as today) {
            <!-- Time In -->
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-600">{{ 'attendance.timeIn' | translate }}</span>
              <span class="text-sm font-medium text-gray-900">{{ today.timeIn || '-' }}</span>
            </div>

            <!-- Time Out -->
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-600">{{ 'attendance.timeOut' | translate }}</span>
              <span class="text-sm font-medium text-gray-900">{{ today.timeOut || '-' }}</span>
            </div>

            @if (today.duration) {
              <!-- Duration -->
              <div class="flex items-center justify-between">
                <span class="text-sm text-gray-600">{{ 'attendance.duration' | translate }}</span>
                <span class="text-sm font-medium text-gray-900">{{ today.duration }}</span>
              </div>
            }
          }

          <!-- Action Buttons -->
          <div class="flex gap-3 pt-4">
            <button
              pButton
              type="button"
              [label]="'attendance.checkIn' | translate"
              icon="pi pi-sign-in"
              class="flex-1"
              [disabled]="!canCheckIn() || isLoading()"
              [loading]="isLoading() && canCheckIn()"
              (click)="checkIn()"
              severity="success">
            </button>
            <button
              pButton
              type="button"
              [label]="'attendance.checkOut' | translate"
              icon="pi pi-sign-out"
              class="flex-1"
              [disabled]="!canCheckOut() || isLoading()"
              [loading]="isLoading() && canCheckOut()"
              (click)="checkOut()"
              severity="danger">
            </button>
          </div>
        </div>
      </p-card>

      <!-- Break Management -->
      <p-card styleClass="shadow-sm border border-gray-200">
        <ng-template pTemplate="header">
          <div class="px-6 pt-6 pb-4 border-b border-gray-100">
            <h2 class="text-lg font-semibold text-gray-900">{{ 'attendance.breaks' | translate }}</h2>
          </div>
        </ng-template>

        <div class="space-y-4">
          <!-- Break Controls -->
          <div class="flex gap-3">
            <button
              pButton
              type="button"
              [label]="'attendance.startBreak' | translate"
              icon="pi pi-play"
              class="flex-1"
              [disabled]="!todayAttendance() || isOnBreak() || todayStatus() === 'checkedOut'"
              (click)="startBreak()"
              severity="info">
            </button>
            <button
              pButton
              type="button"
              [label]="'attendance.endBreak' | translate"
              icon="pi pi-stop"
              class="flex-1"
              [disabled]="!isOnBreak()"
              (click)="endBreak()"
              severity="warn">
            </button>
          </div>

          <!-- Break List -->
          <div class="mt-4">
            <h4 class="text-sm font-medium text-gray-700 mb-2">{{ 'attendance.todayBreaks' | translate }}</h4>
            @if (todayAttendance()?.breaks && todayAttendance()!.breaks!.length > 0) {
              <ul class="space-y-2">
                @for (b of todayAttendance()!.breaks; track b.start) {
                  <li class="flex items-center justify-between p-2 bg-gray-50 rounded">
                    <div class="flex items-center gap-2">
                      <i class="pi pi-clock text-gray-500"></i>
                      <span class="text-sm text-gray-700">{{ b.start }} - {{ b.end || '...' }}</span>
                    </div>
                    <span class="text-sm font-medium" [ngClass]="b.end ? 'text-gray-900' : 'text-blue-600'">
                      {{ b.duration || 'attendance.ongoing' | translate }}
                    </span>
                  </li>
                }
              </ul>
            } @else {
              <p class="text-sm text-gray-500 text-center py-4">{{ 'attendance.noBreaks' | translate }}</p>
            }
          </div>
        </div>
      </p-card>
    </div>

    <!-- Attendance History -->
    <p-card styleClass="shadow-sm border border-gray-200">
      <ng-template pTemplate="header">
        <div class="px-6 pt-6 pb-4 border-b border-gray-100 flex items-center justify-between">
          <h2 class="text-lg font-semibold text-gray-900">{{ 'attendance.history' | translate }}</h2>
          <button pButton type="button" icon="pi pi-refresh" class="p-button-text p-button-sm" (click)="loadAttendanceHistory()"></button>
        </div>
      </ng-template>

      <div class="overflow-x-auto">
        <table class="w-full">
          <thead>
            <tr class="text-left text-sm text-gray-600 border-b border-gray-200">
              <th class="py-3 px-4 font-medium">{{ 'attendance.date' | translate }}</th>
              <th class="py-3 px-4 font-medium">{{ 'attendance.timeIn' | translate }}</th>
              <th class="py-3 px-4 font-medium">{{ 'attendance.timeOut' | translate }}</th>
              <th class="py-3 px-4 font-medium">{{ 'attendance.duration' | translate }}</th>
              <th class="py-3 px-4 font-medium">{{ 'attendance.breakMinutesApplied' | translate }}</th>
              <th class="py-3 px-4 font-medium">{{ 'attendance.status' | translate }}</th>
            </tr>
          </thead>
          <tbody>
            @for (record of attendanceHistory(); track record.date) {
              <tr class="border-b border-gray-100 hover:bg-gray-50">
                <td class="py-3 px-4 text-sm text-gray-900">{{ record.date }}</td>
                <td class="py-3 px-4 text-sm text-gray-700">{{ record.timeIn || '-' }}</td>
                <td class="py-3 px-4 text-sm text-gray-700">{{ record.timeOut || '-' }}</td>
                <td class="py-3 px-4 text-sm text-gray-700">{{ record.duration || '-' }}</td>
                <td class="py-3 px-4 text-sm text-gray-700">{{ record.breakMinutesApplied != null ? (record.breakMinutesApplied + 'm') : '-' }}</td>
                <td class="py-3 px-4">
                  <span class="px-2 py-1 rounded text-xs font-medium" [ngClass]="getStatusClass(record.status)">
                    {{ 'attendance.' + record.status | translate }}
                  </span>
                </td>
              </tr>
            }
            @if (attendanceHistory().length === 0) {
              <tr>
                <td colspan="6" class="py-8 text-center text-gray-500">{{ 'attendance.noRecords' | translate }}</td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </p-card>
  </main>
</div>

<p-toast></p-toast>
