<div class="p-4 sm:p-6">
  <p-toast />
  <p-confirmDialog />
  
  <div class="max-w-6xl mx-auto space-y-6">
    
    <!-- Enhanced Header with Icon -->
    <header class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4">
      <div class="flex items-start gap-4">
        <!-- Icon Badge -->
        <div class="shrink-0 size-12 rounded-xl bg-linear-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-sm">
          <i class="pi pi-calendar-plus text-white text-xl"></i>
        </div>
        
        <!-- Title & Description -->
        <div>
          <h1 class="text-2xl font-semibold text-gray-900 leading-tight">
            {{ 'holidays.title' | translate }}
          </h1>
          <p class="text-sm text-gray-500 mt-1">
            {{ 'holidays.subtitle' | translate }}
          </p>
          
          <!-- Stats Badge -->
          @if (holidays().length > 0) {
            <div class="flex items-center gap-2 mt-3">
              <span class="inline-flex items-center gap-1.5 px-2.5 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium">
                <i class="pi pi-chart-bar text-[10px]"></i>
                {{ holidays().length }} {{ holidays().length === 1 ? 'holiday' : 'holidays' }}
              </span>
            </div>
          }
        </div>
      </div>
      
      <!-- Action Button -->
      <p-button 
        icon="pi pi-plus" 
        [label]="'holidays.addHoliday' | translate"
        size="small"
        (onClick)="openCreateDialog()">
      </p-button>
    </header>

    <!-- Holidays Table Card with Integrated Filters -->
    <section class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
      <h2 class="sr-only">{{ 'holidays.title' | translate }}</h2>
      
      <!-- Card Header with Filters -->
      <div class="px-6 py-4 border-b border-gray-100 bg-gray-50/50">
        <div class="flex items-center justify-between mb-4">
          <div>
            <h3 class="text-sm font-semibold text-gray-900">
              {{ 'holidays.table.title' | translate }}
            </h3>
            <p class="text-xs text-gray-500 mt-0.5">
              Manage company and national holidays
            </p>
          </div>
        </div>
        
        <!-- Filters Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <!-- Year Filter -->
          <div class="form-field">
            <label for="yearFilter" class="form-label">
              {{ 'holidays.filters.year' | translate }}
            </label>
            <p-select
              id="yearFilter"
              [(ngModel)]="selectedYear"
              [options]="yearOptions()"
              optionLabel="label"
              optionValue="value"
              (onChange)="applyFilters()"
              styleClass="w-full"
            />
          </div>

          <!-- Scope Filter -->
          <div class="form-field">
            <label for="scopeFilter" class="form-label">
              {{ 'holidays.filters.scope' | translate }}
            </label>
            <p-select
              id="scopeFilter"
              [(ngModel)]="selectedScope"
              [options]="scopeOptions()"
              optionValue="value"
              (onChange)="applyFilters()"
              styleClass="w-full"
            >
              <ng-template let-option pTemplate="item">
                {{ option.label | translate }}
              </ng-template>
              <ng-template let-option pTemplate="selectedItem">
                {{ option.label | translate }}
              </ng-template>
            </p-select>
          </div>

          <!-- Type Filter -->
          <div class="form-field">
            <label for="typeFilter" class="form-label">
              {{ 'holidays.filters.type' | translate }}
            </label>
            <p-select
              id="typeFilter"
              [(ngModel)]="selectedType"
              [options]="typeOptions()"
              optionLabel="label"
              optionValue="value"
              (onChange)="applyFilters()"
              styleClass="w-full"
            />
          </div>

          <!-- Active Filter -->
          <div class="form-field">
            <label for="activeFilter" class="form-label">
              {{ 'holidays.filters.status' | translate }}
            </label>
            <p-select
              id="activeFilter"
              [(ngModel)]="selectedActive"
              [options]="activeOptions()"
              optionValue="value"
              (onChange)="applyFilters()"
              styleClass="w-full"
            >
              <ng-template let-option pTemplate="item">
                {{ option.label | translate }}
              </ng-template>
              <ng-template let-option pTemplate="selectedItem">
                {{ option.label | translate }}
              </ng-template>
            </p-select>
          </div>
        </div>
      </div>
      
      @if (isLoading()) {
        <!-- Loading State -->
        <div class="p-8 flex items-center justify-center">
          <div class="flex flex-col items-center gap-3 text-gray-400">
            <i class="pi pi-spin pi-spinner text-3xl"></i>
            <span class="text-sm">{{ 'common.loading' | translate }}</span>
          </div>
        </div>
      } @else if (holidays().length === 0) {
        <!-- Empty State -->
        <div class="p-12">
          <div class="max-w-sm mx-auto text-center">
            <div class="inline-flex items-center justify-center size-16 rounded-2xl bg-gray-100 mb-4">
              <i class="pi pi-calendar-times text-3xl text-gray-400"></i>
            </div>
            <h3 class="text-base font-semibold text-gray-900 mb-1">
              {{ 'holidays.noData' | translate }}
            </h3>
            <p class="text-sm text-gray-500 mb-6">
              Get started by creating your first holiday.
            </p>
            <p-button 
              icon="pi pi-plus" 
              [label]="'holidays.addHoliday' | translate"
              size="small"
              (onClick)="openCreateDialog()">
            </p-button>
          </div>
        </div>
      } @else {
        <!-- Table Content -->
        <div class="overflow-x-auto">
          <p-table
            [value]="holidays()"
            styleClass="p-datatable-sm"
            [tableStyle]="{'width': '100%'}"
            [paginator]="true"
            [rows]="10"
            [rowsPerPageOptions]="[10, 25, 50]"
            [showCurrentPageReport]="true"
            currentPageReportTemplate="{{ 'common.table.showing' | translate }}"
          >
            <ng-template pTemplate="header">
              <tr>
                <th pSortableColumn="holidayDate" class="text-left py-3 px-4 text-xs font-semibold text-gray-600 uppercase tracking-wider">
                  {{ 'holidays.table.date' | translate }}
                  <p-sortIcon field="holidayDate" />
                </th>
                <th class="text-left py-3 px-4 text-xs font-semibold text-gray-600 uppercase tracking-wider">
                  {{ 'holidays.table.name' | translate }}
                </th>
                <th class="text-left py-3 px-4 text-xs font-semibold text-gray-600 uppercase tracking-wider">
                  {{ 'holidays.table.type' | translate }}
                </th>
                <th pSortableColumn="scope" class="text-left py-3 px-4 text-xs font-semibold text-gray-600 uppercase tracking-wider">
                  {{ 'holidays.table.scope' | translate }}
                  <p-sortIcon field="scope" />
                </th>
                <th class="text-center py-3 px-4 text-xs font-semibold text-gray-600 uppercase tracking-wider">
                  {{ 'holidays.table.paid' | translate }}
                </th>
                <th class="text-center py-3 px-4 text-xs font-semibold text-gray-600 uppercase tracking-wider">
                  {{ 'holidays.table.status' | translate }}
                </th>
                <th class="text-center py-3 px-4 text-xs font-semibold text-gray-600 uppercase tracking-wider">
                  {{ 'common.actions' | translate }}
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-holiday>
              <tr class="border-b border-gray-100 hover:bg-gray-50 transition-colors">
                <td class="py-3 px-4 text-sm text-gray-900">
                  {{ holiday.holidayDate | date: 'dd/MM/yyyy' }}
                </td>
                <td class="py-3 px-4 text-sm">
                  <strong class="text-gray-900">{{ getHolidayName(holiday) }}</strong>
                </td>
                <td class="py-3 px-4 text-sm text-gray-600">
                  {{ holiday.holidayType }}
                </td>
                <td class="py-3 px-4">
                  <p-tag
                    [value]="holiday.scopeDescription"
                    [severity]="getScopeSeverity(holiday.scope)"
                  />
                </td>
                <td class="py-3 px-4 text-center">
                  <i [class]="holiday.isPaid ? 'pi pi-check-circle text-green-500 text-lg' : 'pi pi-times-circle text-red-500 text-lg'"></i>
                </td>
                <td class="py-3 px-4 text-center">
                  <p-tag
                    [value]="(holiday.isActive ? 'holidays.status.active' : 'holidays.status.inactive') | translate"
                    [severity]="getActiveSeverity(holiday.isActive)"
                  />
                </td>
                <td class="py-3 px-4">
                  <div class="flex items-center justify-center gap-1">
                    <ng-container *ngIf="holiday.scope !== HolidayScope.Global">
                      <p-button
                        icon="pi pi-pencil"
                        [rounded]="true"
                        [text]="true"
                        severity="info"
                        size="small"
                        (onClick)="openEditDialog(holiday)"
                        [pTooltip]="'common.edit' | translate"
                      />
                      <p-button
                        icon="pi pi-trash"
                        [rounded]="true"
                        [text]="true"
                        severity="danger"
                        size="small"
                        (onClick)="deleteHoliday(holiday)"
                        [pTooltip]="'common.delete' | translate"
                      />
                    </ng-container>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      }
    </section>
  </div>

  <!-- Holiday Dialog -->
  <p-dialog 
    [(visible)]="showDialog"
    [modal]="true"
    [style]="{width: '45rem'}"
    [draggable]="false"
    [resizable]="false"
    [showHeader]="false"
    [dismissableMask]="true"
    styleClass="app-dialog">
    
    <!-- Custom Header -->
    <div class="px-6 pt-6 pb-4 border-b border-gray-100">
      <div class="flex items-start gap-4">
        <div class="shrink-0 size-12 rounded-xl flex items-center justify-center shadow-sm"
             [ngClass]="isEditMode() ? 'bg-linear-to-br from-blue-500 to-blue-600' : 'bg-linear-to-br from-green-500 to-green-600'">
          <i [class]="'text-white text-xl ' + (isEditMode() ? 'pi pi-pencil' : 'pi pi-calendar-plus')"></i>
        </div>
        <div class="flex-1 min-w-0">
          <h2 class="text-xl font-semibold text-gray-900 leading-tight">
            {{ (isEditMode() ? 'holidays.editHoliday' : 'holidays.addHoliday') | translate }}
          </h2>
          <p class="text-sm text-gray-500 mt-1">
            {{ (isEditMode() ? 'holidays.editDescription' : 'holidays.createDescription') | translate }}
          </p>
        </div>
        <button 
          type="button"
          (click)="closeDialog()"
          class="shrink-0 size-8 rounded-lg flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-colors"
          [attr.aria-label]="'common.close' | translate">
          <i class="pi pi-times text-lg"></i>
        </button>
      </div>
    </div>
    
    <!-- Form Content -->
    <div class="px-6 py-6">
      <form [formGroup]="holidayForm" class="space-y-5">
      <!-- Name Fr -->
      <div class="form-field">
        <label for="nameFr" class="form-label required">
          {{ 'holidays.form.nameFr' | translate }}
        </label>
        <input
          id="nameFr"
          type="text"
          pInputText
          formControlName="nameFr"
          class="w-full"
          [placeholder]="'holidays.form.nameFrPlaceholder' | translate"
        />
        <small
          *ngIf="holidayForm.get('nameFr')?.invalid && holidayForm.get('nameFr')?.touched"
          class="p-error"
        >
          {{ 'common.validation.required' | translate }}
        </small>
      </div>

      <!-- Name Ar -->
      <div class="form-field">
        <label for="nameAr" class="form-label required">
          {{ 'holidays.form.nameAr' | translate }}
        </label>
        <input
          id="nameAr"
          type="text"
          pInputText
          formControlName="nameAr"
          class="w-full"
          [placeholder]="'holidays.form.nameArPlaceholder' | translate"
        />
        <small
          *ngIf="holidayForm.get('nameAr')?.invalid && holidayForm.get('nameAr')?.touched"
          class="p-error"
        >
          {{ 'common.validation.required' | translate }}
        </small>
      </div>

      <!-- Name En -->
      <div class="form-field">
        <label for="nameEn" class="form-label required">
          {{ 'holidays.form.nameEn' | translate }}
        </label>
        <input
          id="nameEn"
          type="text"
          pInputText
          formControlName="nameEn"
          class="w-full"
          [placeholder]="'holidays.form.nameEnPlaceholder' | translate"
        />
        <small
          *ngIf="holidayForm.get('nameEn')?.invalid && holidayForm.get('nameEn')?.touched"
          class="p-error"
        >
          {{ 'common.validation.required' | translate }}
        </small>
      </div>

      <!-- Date -->
      <div class="form-field">
        <label for="holidayDate" class="form-label required">
          {{ 'holidays.form.date' | translate }}
        </label>
        <p-datepicker
          id="holidayDate"
          formControlName="holidayDate"
          [showIcon]="true"
          dateFormat="dd/mm/yy"
          [placeholder]="'holidays.form.selectDate' | translate"
          styleClass="w-full"
        />
        <small
          *ngIf="holidayForm.get('holidayDate')?.invalid && holidayForm.get('holidayDate')?.touched"
          class="p-error"
        >
          {{ 'common.validation.required' | translate }}
        </small>
      </div>

      <!-- Type -->
      <div class="form-field">
        <label for="holidayType" class="form-label required">
          {{ 'holidays.form.type' | translate }}
        </label>
        <input
          id="holidayType"
          type="text"
          pInputText
          formControlName="holidayType"
          class="w-full"
          [placeholder]="'holidays.form.typePlaceholder' | translate"
        />
        <small
          *ngIf="holidayForm.get('holidayType')?.invalid && holidayForm.get('holidayType')?.touched"
          class="p-error"
        >
          {{ 'common.validation.required' | translate }}
        </small>
      </div>

      <!-- Description -->
      <div class="form-field">
        <label for="description" class="form-label">
          {{ 'holidays.form.description' | translate }}
        </label>
        <textarea
          id="description"
          pTextarea
          formControlName="description"
          [rows]="3"
          class="w-full"
          [placeholder]="'holidays.form.descriptionPlaceholder' | translate"
        ></textarea>
      </div>

      <!-- Checkboxes Grid -->
      <div class="checkboxes-grid">
        <div class="checkbox-field">
          <p-checkbox
            formControlName="isMandatory"
            [binary]="true"
            inputId="isMandatory"
          />
          <label for="isMandatory" class="checkbox-label">
            {{ 'holidays.form.mandatory' | translate }}
          </label>
        </div>

        <div class="checkbox-field">
          <p-checkbox
            formControlName="isPaid"
            [binary]="true"
            inputId="isPaid"
          />
          <label for="isPaid" class="checkbox-label">
            {{ 'holidays.form.paid' | translate }}
          </label>
        </div>

        <div class="checkbox-field">
          <p-checkbox
            formControlName="affectPayroll"
            [binary]="true"
            inputId="affectPayroll"
          />
          <label for="affectPayroll" class="checkbox-label">
            {{ 'holidays.form.affectPayroll' | translate }}
          </label>
        </div>

        <div class="checkbox-field">
          <p-checkbox
            formControlName="affectAttendance"
            [binary]="true"
            inputId="affectAttendance"
          />
          <label for="affectAttendance" class="checkbox-label">
            {{ 'holidays.form.affectAttendance' | translate }}
          </label>
        </div>

        <div class="checkbox-field">
          <p-checkbox
            formControlName="isActive"
            [binary]="true"
            inputId="isActive"
          />
          <label for="isActive" class="checkbox-label">
            {{ 'holidays.form.active' | translate }}
          </label>
        </div>
      </div>

      <!-- Recurrence -->
      <div class="form-field">
        <label for="recurrence" class="form-label required">
          {{ 'holidays.form.recurrence' | translate }}
        </label>
        <p-select
          id="recurrence"
          formControlName="recurrence"
          [options]="recurrenceOptions()"
          optionLabel="label"
          optionValue="value"
          styleClass="w-full"
        >
          <ng-template let-option pTemplate="item">
            {{ option.label | translate }}
          </ng-template>
          <ng-template let-option pTemplate="selectedItem">
            {{ option.label | translate }}
          </ng-template>
        </p-select>
        <small class="block mt-2 text-xs text-gray-500">
          {{ 'holidays.form.recurrenceHint' | translate }}
        </small>
      </div>

      <!-- Year (only for non-recurring) -->
      <div class="form-field" *ngIf="holidayForm.get('recurrence')?.value === 'none'">
        <label for="year" class="form-label">
          {{ 'holidays.form.year' | translate }}
        </label>
        <input
          id="year"
          type="number"
          pInputText
          formControlName="year"
          class="w-full"
          [placeholder]="'holidays.form.yearPlaceholder' | translate"
        />
      </div>
      </form>
    </div>

    <!-- Footer Actions -->
    <div class="px-6 py-4 bg-gray-50 border-t border-gray-100">
      <div class="flex items-center justify-end gap-3">
        <p-button 
          [label]="'common.cancel' | translate" 
          severity="secondary"
          size="small"
          (onClick)="closeDialog()">
        </p-button>
        <p-button 
          [label]="(isEditMode() ? 'common.update' : 'common.create') | translate" 
          [icon]="isEditMode() ? 'pi pi-check' : 'pi pi-plus'"
          size="small"
          [disabled]="holidayForm.invalid"
          (onClick)="saveHoliday()">
        </p-button>
      </div>
    </div>
  </p-dialog>
</div>
