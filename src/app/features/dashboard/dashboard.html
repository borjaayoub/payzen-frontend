<div class="flex flex-col gap-6 p-6">
  <!-- Expert Navigation -->
  @if (isExpertMode() && isClientView()) {
    <div class="bg-amber-50 border border-amber-200 rounded-lg p-3 flex items-center justify-between mb-2">
      <div class="flex items-center gap-2 text-amber-800">
        <i class="pi pi-eye text-lg"></i>
        <span class="font-medium">{{ 'expert.dashboard.viewingAsExpert' | translate }}</span>
      </div>
      <button
        pButton
        type="button"
        [label]="'expert.dashboard.backToPortfolio' | translate"
        icon="pi pi-arrow-left"
        class="p-button-text p-button-sm p-button-warning"
        (click)="backToPortfolio()"
      ></button>
    </div>
  }

  <!-- Header Section -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="heading">{{ 'dashboard.title' | translate }}</h1>
      <p class="subheading mt-1">{{ 'dashboard.subtitle' | translate }}</p>
    </div>
  </div>

  <!-- Metrics Grid -->
  <div class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3">
    @for (metric of metrics(); track metric.title) {
      <p-card styleClass="card h-full">
        <div class="stat-card items-start justify-between gap-4 p-0 border-none shadow-none">
          <div class="flex-1">
            <p class="text-sm text-(--text-secondary) mb-1">{{ metric.title | translate }}</p>
            <h3 class="text-2xl font-semibold text-(--text-primary) mb-2">{{ metric.value }}</h3>
            <div class="flex items-center gap-1 text-sm">
              <i
                [class]="metric.changeType === 'increase' ? 'pi pi-arrow-up text-(--success)' : 'pi pi-arrow-down text-(--danger)'"
                class="text-xs"
              ></i>
              <span
                [class]="metric.changeType === 'increase' ? 'text-(--success)' : 'text-(--danger)'"
                class="font-medium"
              >
                {{ metric.change }}
              </span>
              <span class="text-xs text-(--text-secondary) ml-1">{{ 'dashboard.vsLastMonth' | translate }}</span>
            </div>
          </div>
          <div [class]="'flex items-center justify-center w-12 h-12 rounded-lg ' + metric.bgColor">
            <i [class]="'pi ' + metric.icon + ' ' + metric.iconColor" class="text-xl"></i>
          </div>
        </div>
      </p-card>
    }
  </div>

  <!-- Charts and Content Section -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
    <!-- Charts Section - Takes 2 columns on large screens -->
    <div class="grid grid-cols-1 gap-4 lg:col-span-2">
      <!-- Payroll Evolution Chart -->
      <p-card styleClass="card">
        <ng-template pTemplate="header">
          <div class="p-4 pb-0">
            <h3 class="card-title">{{ 'dashboard.charts.payrollEvolution' | translate }}</h3>
            <p class="text-sm text-(--text-secondary) mt-1">{{ 'dashboard.charts.trend6Months' | translate }}</p>
          </div>
        </ng-template>
        <div class="h-[300px]">
          <p-chart type="line" [data]="chartData()" [options]="chartOptions()" class="h-full"></p-chart>
        </div>
      </p-card>

      <!-- Employee Distribution Chart -->
      <p-card styleClass="card">
        <ng-template pTemplate="header">
          <div class="p-4 pb-0">
            <h3 class="card-title">{{ 'dashboard.charts.employeeDistribution' | translate }}</h3>
            <p class="text-sm text-(--text-secondary) mt-1">{{ 'dashboard.charts.byContractType' | translate }}</p>
          </div>
        </ng-template>
        <div class="flex items-center justify-center h-[300px]">
          <p-chart type="doughnut" [data]="employeeChartData()" [options]="employeeChartOptions()" class="w-full max-w-[300px]"></p-chart>
        </div>
      </p-card>
    </div>

    <!-- Sidebar - Takes 1 column on large screens -->
    <div class="flex flex-col gap-4">
      <!-- Recent Payslips -->
      <p-card styleClass="card h-full">
        <ng-template pTemplate="header">
          <div class="p-4 pb-0">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-(--primary-light)">
                  <i class="pi pi-file-edit text-(--primary)"></i>
                </div>
                <div>
                  <h3 class="card-title text-base">{{ 'dashboard.recentPayslips.title' | translate }}</h3>
                  <p class="text-xs text-(--text-secondary)">{{ 'dashboard.recentPayslips.subtitle' | translate }}</p>
                </div>
              </div>
              <a href="/payslips" class="text-sm font-medium text-(--primary) hover:text-(--primary-hover) flex items-center gap-1">
                {{ 'common.viewAll' | translate }}
                <i class="pi pi-arrow-right text-xs"></i>
              </a>
            </div>
          </div>
        </ng-template>
        <div class="flex flex-col gap-3">
            @for (payslip of recentPayslips; track payslip.id) {
            <div class="flex items-center gap-3 p-3 rounded-lg border border-(--border-color-subtle) hover:bg-(--bg-hover) transition-colors">
              <p-avatar
                icon="pi pi-user"
                shape="circle"
                styleClass="bg-(--primary-light) text-(--primary)"
              ></p-avatar>
              <div class="flex-1 min-w-0">
                <p class="text-sm font-medium text-(--text-primary) truncate">{{ payslip.employeeName }}</p>
                <p class="text-xs text-(--text-secondary)">{{ payslip.amount }}</p>
                </div>
              <p-tag
                [value]="getStatusLabel(payslip.status) | translate"
                [severity]="getStatusSeverity(payslip.status)"
              ></p-tag>
              </div>
            }
        </div>
      </p-card>

      <!-- Quick Actions -->
      <p-card styleClass="card h-full">
        <ng-template pTemplate="header">
          <div class="p-4 pb-0">
            <h3 class="card-title text-base">{{ 'dashboard.quickActions.title' | translate }}</h3>
          </div>
        </ng-template>
        <div class="flex flex-col gap-2">
            @for (action of quickActions(); track action.title) {
            <a
              [routerLink]="action.route"
              class="flex items-center gap-3 p-3 rounded-lg border border-(--border-color-subtle) hover:bg-(--bg-hover) transition-colors group"
            >
              <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-(--primary-light) group-hover:bg-(--primary-light)/80 transition-colors">
                <i [class]="'pi ' + action.icon + ' ' + action.iconColor"></i>
                </div>
              <span class="flex-1 text-sm font-medium text-(--text-primary)">{{ action.title | translate }}</span>
              <i class="pi pi-chevron-right text-(--text-muted) text-xs"></i>
              </a>
            }
        </div>
      </p-card>
    </div>
  </div>
</div>
