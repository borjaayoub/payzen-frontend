<div class="min-h-screen bg-gray-50">
  <p-toast />
  <p-confirmDialog />

  <div>
    <div class="max-w-7xl mx-auto px-6 pt-4">
      <!-- Header -->
      <div class="flex items-center justify-between mb-6">
        <div>
          <div class="flex items-center gap-3 mb-2">
            <div class="bg-(--primary)/10 text-(--primary) p-3 rounded-(--rads-lg)">
              <i class="pi pi-clock text-2xl"></i>
            </div>
            <div>
              <h1 class="heading">
                {{ 'overtime.title' | translate }}
              </h1>
              <p class="subheading mt-1">
                {{ 'overtime.subtitle' | translate }}
              </p>
            </div>
          </div>
        </div>
        <div>
          <p-button
            [label]="'overtime.declareOvertime' | translate"
            icon="pi pi-plus"
            (onClick)="openCreateDialog()"
          />
        </div>
      </div>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-6 py-6">
    <!-- Overtimes Table -->
    <div class="card">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold text-(--text-primary)">
          {{ 'overtime.myRequests' | translate }}
        </h2>
      </div>

      <p-table
        [value]="overtimes()"
        [loading]="isLoading()"
        styleClass="p-datatable-sm"
        [tableStyle]="{'min-width': '50rem'}"
      >
        <ng-template pTemplate="header">
          <tr>
            <th class="saas-table-header">{{ 'overtime.table.date' | translate }}</th>
            <th class="saas-table-header">{{ 'overtime.table.type' | translate }}</th>
            <th class="saas-table-header">{{ 'overtime.table.time' | translate }}</th>
            <th class="saas-table-header">{{ 'overtime.table.totalHours' | translate }}</th>
            <th class="saas-table-header">{{ 'overtime.table.reason' | translate }}</th>
            <th class="saas-table-header">{{ 'overtime.table.status' | translate }}</th>
            <th class="saas-table-header">{{ 'common.actions' | translate }}</th>
          </tr>
        </ng-template>
        
        <ng-template pTemplate="body" let-overtime>
          <tr class="saas-table-row">
            <!-- Date -->
            <td class="px-6 py-4">{{ overtime.overtimeDate | date: 'dd/MM/yyyy' }}</td>

            <!-- Type -->
            <td class="px-6 py-4">
              <p-tag 
                [value]="getTypeLabel(overtime.overtimeType)" 
                [severity]="overtime.overtimeType === OvertimeType.Hourly ? 'info' : 'warn'"
              ></p-tag>
            </td>

            <!-- Time -->
            <td class="px-6 py-4">
              @if (overtime.overtimeType === OvertimeType.Hourly) {
                <span>{{ overtime.startTime }} - {{ overtime.endTime }}</span>
              } @else {
                <span>-</span>
              }
            </td>

            <!-- Total Hours -->
            <td class="px-6 py-4">
              <strong>{{ overtime.totalHours | number: '1.2-2' }}h</strong>
            </td>

            <!-- Reason -->
            <td class="px-6 py-4">
              <span class="text-sm text-(--text-secondary)">{{ overtime.reason || '-' }}</span>
            </td>

            <!-- Status -->
            <td class="px-6 py-4">
              <p-tag
                [value]="overtime.statusDescription"
                [severity]="getStatusSeverity(overtime.status)"
              />
            </td>

            <!-- Actions -->
            <td class="px-6 py-4">
              <div class="flex items-center gap-2">
                @if (canEdit(overtime)) {
                  <button
                    pButton
                    icon="pi pi-pencil"
                    [pTooltip]="'common.edit' | translate"
                    tooltipPosition="top"
                    (click)="openEditDialog(overtime)"
                    severity="info"
                    [text]="true"
                    [rounded]="true"
                  ></button>
                }
                @if (canCancel(overtime)) {
                  <button
                    pButton
                    icon="pi pi-times"
                    [pTooltip]="'overtime.cancel' | translate"
                    tooltipPosition="top"
                    (click)="cancelOvertime(overtime)"
                    severity="warn"
                    [text]="true"
                    [rounded]="true"
                  ></button>
                }
                @if (canEdit(overtime)) {
                  <button
                    pButton
                    icon="pi pi-trash"
                    [pTooltip]="'common.delete' | translate"
                    tooltipPosition="top"
                    (click)="deleteOvertime(overtime)"
                    severity="danger"
                    [text]="true"
                    [rounded]="true"
                  ></button>
                }
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="7" class="text-center py-8">
              <div class="flex flex-col items-center gap-3">
                <i class="pi pi-inbox text-4xl text-(--text-secondary)"></i>
                <p class="text-(--text-secondary)">{{ 'overtime.noData' | translate }}</p>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>

  <!-- Overtime Dialog -->
  <p-dialog
    [header]="(isEditMode() ? 'overtime.editOvertime' : 'overtime.addOvertime') | translate"
    [(visible)]="showDialog"
    [modal]="true"
    [style]="{width: '600px'}"
    [draggable]="false"
    [resizable]="false"
    styleClass="app-dialog"
  >
    <form [formGroup]="overtimeForm" class="overtime-form">
      <!-- Overtime Type (moved before date) -->
      <div class="form-field">
        <label for="overtimeType" class="form-label required">
          {{ 'overtime.form.type' | translate }}
        </label>
        <p-select
          id="overtimeType"
          formControlName="overtimeType"
          [options]="typeOptions()"
          optionLabel="label"
          optionValue="value"
          [placeholder]="'overtime.form.selectType' | translate"
          styleClass="w-full"
        ></p-select>
        @if (overtimeForm.get('overtimeType')?.invalid && overtimeForm.get('overtimeType')?.touched) {
          <small class="p-error">
            {{ 'common.validation.required' | translate }}
          </small>
        }
      </div>

      <!-- Date -->
      <div class="form-field">
        <label for="overtimeDate" class="form-label required">
          {{ 'overtime.form.date' | translate }}
        </label>
        <p-datepicker
          id="overtimeDate"
          formControlName="overtimeDate"
          [showIcon]="true"
          dateFormat="dd/mm/yy"
          [placeholder]="'overtime.form.selectDate' | translate"
          styleClass="w-full"
        ></p-datepicker>
        @if (overtimeForm.get('overtimeDate')?.invalid && overtimeForm.get('overtimeDate')?.touched) {
          <small class="p-error">
            {{ 'common.validation.required' | translate }}
          </small>
        }
      </div>

      <!-- Start Time (only for Hourly) -->
      @if (selectedOvertimeType() === 1) {
        <div class="form-field">
          <label for="startTime" class="form-label required">
            {{ 'overtime.form.startTime' | translate }}
          </label>
          <input
            id="startTime"
            type="time"
            pInputText
            formControlName="startTime"
            class="w-full"
          />
          @if (overtimeForm.get('startTime')?.invalid && overtimeForm.get('startTime')?.touched) {
            <small class="p-error">
              {{ 'common.validation.required' | translate }}
            </small>
          }
        </div>
      }

      <!-- End Time (only for Hourly) -->
      @if (selectedOvertimeType() === 1) {
        <div class="form-field">
          <label for="endTime" class="form-label required">
            {{ 'overtime.form.endTime' | translate }}
          </label>
          <input
            id="endTime"
            type="time"
            pInputText
            formControlName="endTime"
            class="w-full"
          />
          @if (overtimeForm.get('endTime')?.invalid && overtimeForm.get('endTime')?.touched) {
            <small class="p-error">
              {{ 'common.validation.required' | translate }}
            </small>
          }
        </div>
      }

      <!-- Reason -->
      <div class="form-field">
        <label for="reason" class="form-label">
          {{ 'overtime.form.reason' | translate }}
        </label>
        <textarea
          id="reason"
          pTextarea
          formControlName="reason"
          [rows]="3"
          class="w-full"
          [placeholder]="'overtime.form.reasonPlaceholder' | translate"
        ></textarea>
      </div>
    </form>

    <ng-template pTemplate="footer">
      <div class="dialog-footer">
        <p-button
          [label]="'common.cancel' | translate"
          severity="secondary"
          [outlined]="true"
          (onClick)="closeDialog()"
        />
        <p-button
          [label]="'common.save' | translate"
          (onClick)="saveOvertime()"
          [disabled]="overtimeForm.invalid"
        />
      </div>
    </ng-template>
  </p-dialog>
</div>
