<div class="card">
  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="form-container">
    
    <!-- Error Message -->
    @if (errorMessage()) {
      <div class="alert alert-error">
        <i class="pi pi-exclamation-circle"></i>
        <span>{{ errorMessage() }}</span>
      </div>
    }

    <!-- Company Details Section -->
    <section class="form-section">
      <div class="form-section-header">
        <h3 class="form-section-title">
          {{ 'company.info.title' | translate }}
        </h3>
        <p class="form-section-description">Please provide the legal information for the company.</p>
      </div>
      
      <div class="form-grid">
        <!-- Company Name -->
        <div class="form-field">
          <label class="form-label form-label-required">
            {{ 'company.info.raisonSociale' | translate }}
          </label>
          <input pInputText formControlName="companyName" class="input" [class.ng-invalid]="form.get('companyName')?.invalid && form.get('companyName')?.touched"/>
          @if (form.get('companyName')?.invalid && form.get('companyName')?.touched) {
            <small class="form-error">This field is required</small>
          }
        </div>

        <!-- ICE -->
        <div class="form-field">
          <label class="form-label form-label-required">
            {{ 'company.info.ice' | translate }}
          </label>
          <input pInputText formControlName="ice" class="input" />
        </div>

        <!-- Email -->
        <div class="form-field">
          <label class="form-label form-label-required">
            {{ 'company.info.email' | translate }}
          </label>
          <input pInputText formControlName="email" class="input" />
        </div>

        <!-- Phone -->
        <div class="form-field">
          <label class="form-label form-label-required">
            {{ 'company.info.phone' | translate }}
          </label>
          <input pInputText formControlName="phone" class="input" />
        </div>

        <!-- CNSS -->
        <div class="form-field">
          <label class="form-label form-label-required">
            {{ 'company.info.cnss' | translate }}
          </label>
          <input pInputText formControlName="cnss" class="input" />
        </div>

        <!-- Address -->
        <div class="form-field-full">
          <label class="form-label form-label-required">
            {{ 'company.info.address' | translate }}
          </label>
          <input pInputText formControlName="address" class="input" />
        </div>

        <!-- City -->
        <div class="form-field">
          <app-select-field
            formControlName="city"
            [label]="'company.info.city' | translate"
            [requiredMark]="true"
            [options]="cities()"
            optionLabel="label"
            optionValue="label"
            variant="autocomplete"
            [creatable]="true"
            [createLabel]="'Create city'"
            [placeholder]="'Type to search or create a city'"
            [showClear]="true"
            (searchQuery)="onCitySearch($event)"
            (create)="onCreateCity($event)"
          ></app-select-field>
        </div>

        <!-- RC -->
        <div class="form-field">
          <label class="form-label">
            {{ 'company.info.rc' | translate }}
          </label>
          <input pInputText formControlName="rc" class="input" />
        </div>

        <!-- IF -->
        <div class="form-field">
          <label class="form-label">IF</label>
          <input pInputText formControlName="if" class="input" />
        </div>

        <!-- RIB -->
        <div class="form-field">
          <label class="form-label">RIB</label>
          <input pInputText formControlName="rib" class="input" />
        </div>
      </div>
    </section>

    <!-- Admin User Section (Create Only) -->
    @if (mode === 'create') {
      <section class="form-section form-divider">
        <div class="form-section-header">
          <h3 class="form-section-title">Admin User</h3>
          <p class="form-section-description">Create an administrator account for this company.</p>
        </div>
        
        <div class="form-grid">
          <!-- First Name -->
          <div class="form-field">
            <label class="form-label form-label-required">First Name</label>
            <input pInputText formControlName="adminFirstName" class="input" />
          </div>

          <!-- Last Name -->
          <div class="form-field">
            <label class="form-label form-label-required">Last Name</label>
            <input pInputText formControlName="adminLastName" class="input" />
          </div>

          <!-- Admin Email -->
          <div class="form-field">
            <label class="form-label form-label-required">Admin Email</label>
            <input pInputText formControlName="adminEmail" class="input" />
          </div>

          <!-- Admin Phone -->
          <div class="form-field">
            <label class="form-label form-label-required">Admin Phone</label>
            <input pInputText formControlName="adminPhone" class="input" />
          </div>

          <!-- Password Generation -->
          <div class="form-field-full">
            <div class="form-info-box-gray">
              <div class="flex items-center gap-2">
                <p-checkbox formControlName="generatePassword" [binary]="true" inputId="genPass"></p-checkbox>
                <label for="genPass" class="form-label cursor-pointer select-none">Auto-generate secure password</label>
              </div>
              
              <!-- Manual Password (if not generated) -->
              @if (!form.get('generatePassword')?.value) {
                <div class="form-field mt-3 pl-7">
                  <label class="form-label">Password</label>
                  <input pInputText type="password" formControlName="adminPassword" class="input" placeholder="Enter password" />
                </div>
              }
            </div>
          </div>
        </div>
      </section>
    }

    <!-- Actions -->
    <div class="form-actions">
      <button 
        pButton 
        type="button" 
        label="Cancel" 
        class="btn-secondary-outline" 
        (click)="onCancel()"
        [disabled]="isLoading()">
      </button>
      <button 
        pButton 
        type="submit" 
        [label]="mode === 'create' ? 'Create Client' : 'Save Changes'" 
        class="btn-primary"
        [loading]="isLoading()">
      </button>
    </div>
  </form>
</div>
